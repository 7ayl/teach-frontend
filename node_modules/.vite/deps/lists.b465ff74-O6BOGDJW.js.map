{
  "version": 3,
  "sources": ["../../../../../node_modules/.pnpm/ink-mde@0.18.1_vue@3.2.47/node_modules/ink-mde/src/vendor/extensions/lists.ts"],
  "sourcesContent": ["import { syntaxTree } from '@codemirror/language'\nimport { RangeSet, StateField } from '@codemirror/state'\nimport { Decoration, EditorView, ViewPlugin } from '@codemirror/view'\nimport type { EditorState, Extension, Range } from '@codemirror/state'\nimport type { DecorationSet, WidgetType } from '@codemirror/view'\n\ninterface Widget extends WidgetType {\n  compare: (widget: Widget) => boolean,\n  isChecked?: boolean,\n}\n\nconst dotWidget = (): Widget => {\n  return {\n    compare: (_other: Widget) => {\n      return false\n    },\n    destroy: () => {},\n    eq: (_other: Widget) => {\n      return false\n    },\n    estimatedHeight: -1,\n    ignoreEvent: () => true,\n    toDOM: () => {\n      const span = document.createElement('span')\n\n      span.innerHTML = '&#x2022;'\n      span.setAttribute('aria-hidden', 'true')\n\n      return span\n    },\n    updateDOM: () => false,\n  }\n}\n\nconst taskWidget = (isChecked: boolean): Widget => {\n  return {\n    compare: (other: Widget) => {\n      return other.isChecked === isChecked\n    },\n    destroy: () => {},\n    eq: (other: Widget) => {\n      return other.isChecked === isChecked\n    },\n    estimatedHeight: -1,\n    ignoreEvent: () => false,\n    isChecked,\n    toDOM: () => {\n      const input = document.createElement('input')\n\n      input.setAttribute('aria-hidden', 'true')\n      input.className = 'ink-mde-task-toggle'\n      input.type = 'checkbox'\n      input.checked = isChecked\n\n      return input\n    },\n    updateDOM: () => false,\n  }\n}\n\nconst hasOverlap = (x1: number, x2: number, y1: number, y2: number) => {\n  return Math.max(x1, y1) <= Math.min(x2, y2)\n}\n\nconst isCursorInRange = (state: EditorState, from: number, to: number) => {\n  return state.selection.ranges.some((range) => {\n    return hasOverlap(from, to, range.from, range.to)\n  })\n}\n\nconst toggleTask = (view: EditorView, position: number) => {\n  const before = view.state.sliceDoc(position + 2, position + 5)\n\n  view.dispatch({\n    changes: {\n      from: position + 2,\n      to: position + 5,\n      insert: before === '[ ]' ? '[x]' : '[ ]',\n    },\n  })\n\n  return true\n}\n\nexport const lists = (): Extension => {\n  const dotDecoration = () => Decoration.replace({\n    widget: dotWidget(),\n  })\n\n  const taskDecoration = (isChecked: boolean) => Decoration.replace({\n    widget: taskWidget(isChecked),\n  })\n\n  const decorate = (state: EditorState) => {\n    const widgets: Range<Decoration>[] = []\n\n    syntaxTree(state).iterate({\n      enter: ({ type, from, to }) => {\n        if (type.name === 'ListMark' && !isCursorInRange(state, from, to)) {\n          const task = state.sliceDoc(to + 1, to + 4)\n\n          if (!['[ ]', '[x]'].includes(task)) {\n            const marker = state.sliceDoc(from, to)\n\n            if (['-', '*'].includes(marker)) {\n              widgets.push(dotDecoration().range(from, to))\n            }\n          }\n        }\n\n        if (type.name === 'TaskMarker' && !isCursorInRange(state, from - 2, to)) {\n          const task = state.sliceDoc(from, to)\n\n          widgets.push(taskDecoration(task === '[x]').range(from - 2, to))\n        }\n      },\n    })\n\n    return widgets.length > 0 ? RangeSet.of(widgets) : Decoration.none\n  }\n\n  const viewPlugin = ViewPlugin.define(() => ({}), {\n    eventHandlers: {\n      mousedown: (event, view) => {\n        const target = event.target as HTMLElement\n\n        if (target?.nodeName === 'INPUT' && target.classList.contains('ink-mde-task-toggle')) {\n          return toggleTask(view, view.posAtDOM(target))\n        }\n      },\n    },\n  })\n  const stateField = StateField.define<DecorationSet>({\n    create(state) {\n      return decorate(state)\n    },\n    update(_references, { state }) {\n      return decorate(state)\n    },\n    provide(field) {\n      return EditorView.decorations.from(field)\n    },\n  })\n\n  return [\n    viewPlugin,\n    stateField,\n  ]\n}\n"],
  "mappings": "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",
  "names": []
}
