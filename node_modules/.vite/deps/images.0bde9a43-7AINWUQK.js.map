{
  "version": 3,
  "sources": ["../../../../../node_modules/.pnpm/ink-mde@0.18.1_vue@3.2.47/node_modules/ink-mde/src/vendor/extensions/images.ts"],
  "sourcesContent": ["import { syntaxTree } from '@codemirror/language'\nimport type { EditorState, Extension, Range } from '@codemirror/state'\nimport { RangeSet, StateField } from '@codemirror/state'\nimport type { DecorationSet } from '@codemirror/view'\nimport { Decoration, EditorView, WidgetType } from '@codemirror/view'\n\ninterface ImageWidgetParams {\n  url: string,\n}\n\nclass ImageWidget extends WidgetType {\n  readonly url\n\n  constructor({ url }: ImageWidgetParams) {\n    super()\n\n    this.url = url\n  }\n\n  eq(imageWidget: ImageWidget) {\n    return imageWidget.url === this.url\n  }\n\n  toDOM() {\n    const container = document.createElement('div')\n    const backdrop = container.appendChild(document.createElement('div'))\n    const figure = backdrop.appendChild(document.createElement('figure'))\n    const image = figure.appendChild(document.createElement('img'))\n\n    container.setAttribute('aria-hidden', 'true')\n    container.className = 'cm-image-container'\n    backdrop.className = 'cm-image-backdrop'\n    figure.className = 'cm-image-figure'\n    image.className = 'cm-image-img'\n    image.src = this.url\n\n    container.style.paddingBottom = '0.5rem'\n    container.style.paddingTop = '0.5rem'\n\n    backdrop.classList.add('cm-image-backdrop')\n\n    backdrop.style.borderRadius = 'var(--ink-internal-border-radius)'\n    backdrop.style.display = 'flex'\n    backdrop.style.alignItems = 'center'\n    backdrop.style.justifyContent = 'center'\n    backdrop.style.overflow = 'hidden'\n    backdrop.style.maxWidth = '100%'\n\n    figure.style.margin = '0'\n\n    image.style.display = 'block'\n    image.style.maxHeight = 'var(--ink-internal-block-max-height)'\n    image.style.maxWidth = '100%'\n    image.style.width = '100%'\n\n    return container\n  }\n}\n\nexport const images = (): Extension => {\n  const imageRegex = /!\\[.*?\\]\\((?<url>.*?)\\)/\n\n  const imageDecoration = (imageWidgetParams: ImageWidgetParams) => Decoration.widget({\n    widget: new ImageWidget(imageWidgetParams),\n    side: -1,\n    block: true,\n  })\n\n  const decorate = (state: EditorState) => {\n    const widgets: Range<Decoration>[] = []\n\n    syntaxTree(state).iterate({\n      enter: ({ type, from, to }) => {\n        if (type.name === 'Image') {\n          const result = imageRegex.exec(state.doc.sliceString(from, to))\n\n          if (result && result.groups && result.groups.url)\n            widgets.push(imageDecoration({ url: result.groups.url }).range(state.doc.lineAt(from).from))\n        }\n      },\n    })\n\n    return widgets.length > 0 ? RangeSet.of(widgets) : Decoration.none\n  }\n\n  const imagesField = StateField.define<DecorationSet>({\n    create(state) {\n      return decorate(state)\n    },\n    update(images, transaction) {\n      if (transaction.docChanged)\n        return decorate(transaction.state)\n\n      return images.map(transaction.changes)\n    },\n    provide(field) {\n      return EditorView.decorations.from(field)\n    },\n  })\n\n  return [\n    imagesField,\n  ]\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAUA,IAAM,cAAN,cAA0B,WAAW;EAGnC,YAAY,EAAE,IAAA,GAA0B;AAChC,UAAA;AAHC;AAKP,SAAK,MAAM;EAAA;EAGb,GAAG,aAA0B;AACpB,WAAA,YAAY,QAAQ,KAAK;EAAA;EAGlC,QAAQ;AACA,UAAA,YAAY,SAAS,cAAc,KAAK;AAC9C,UAAM,WAAW,UAAU,YAAY,SAAS,cAAc,KAAK,CAAC;AACpE,UAAM,SAAS,SAAS,YAAY,SAAS,cAAc,QAAQ,CAAC;AACpE,UAAM,QAAQ,OAAO,YAAY,SAAS,cAAc,KAAK,CAAC;AAEpD,cAAA,aAAa,eAAe,MAAM;AAC5C,cAAU,YAAY;AACtB,aAAS,YAAY;AACrB,WAAO,YAAY;AACnB,UAAM,YAAY;AAClB,UAAM,MAAM,KAAK;AAEjB,cAAU,MAAM,gBAAgB;AAChC,cAAU,MAAM,aAAa;AAEpB,aAAA,UAAU,IAAI,mBAAmB;AAE1C,aAAS,MAAM,eAAe;AAC9B,aAAS,MAAM,UAAU;AACzB,aAAS,MAAM,aAAa;AAC5B,aAAS,MAAM,iBAAiB;AAChC,aAAS,MAAM,WAAW;AAC1B,aAAS,MAAM,WAAW;AAE1B,WAAO,MAAM,SAAS;AAEtB,UAAM,MAAM,UAAU;AACtB,UAAM,MAAM,YAAY;AACxB,UAAM,MAAM,WAAW;AACvB,UAAM,MAAM,QAAQ;AAEb,WAAA;EAAA;AAEX;AAEO,IAAM,SAAS,MAAiB;AACrC,QAAM,aAAa;AAEnB,QAAM,kBAAkB,CAAC,sBAAyC,WAAW,OAAO;IAClF,QAAQ,IAAI,YAAY,iBAAiB;IACzC,MAAM;IACN,OAAO;EAAA,CACR;AAEK,QAAA,WAAW,CAAC,UAAuB;AACvC,UAAM,UAA+B,CAAA;AAE1B,eAAA,KAAK,EAAE,QAAQ;MACxB,OAAO,CAAC,EAAE,MAAM,MAAM,GAAA,MAAS;AACzB,YAAA,KAAK,SAAS,SAAS;AACnB,gBAAA,SAAS,WAAW,KAAK,MAAM,IAAI,YAAY,MAAM,EAAE,CAAC;AAE9D,cAAI,UAAU,OAAO,UAAU,OAAO,OAAO;AAC3C,oBAAQ,KAAK,gBAAgB,EAAE,KAAK,OAAO,OAAO,IAAI,CAAC,EAAE,MAAM,MAAM,IAAI,OAAO,IAAI,EAAE,IAAI,CAAC;QAAA;MAC/F;IACF,CACD;AAED,WAAO,QAAQ,SAAS,IAAI,SAAS,GAAG,OAAO,IAAI,WAAW;EAAA;AAG1D,QAAA,cAAc,WAAW,OAAsB;IACnD,OAAO,OAAO;AACZ,aAAO,SAAS,KAAK;IAAA;IAEvB,OAAOA,SAAQ,aAAa;AAC1B,UAAI,YAAY;AACP,eAAA,SAAS,YAAY,KAAK;AAE5BA,aAAAA,QAAO,IAAI,YAAY,OAAO;IAAA;IAEvC,QAAQ,OAAO;AACN,aAAA,WAAW,YAAY,KAAK,KAAK;IAAA;EAC1C,CACD;AAEM,SAAA;IACL;EAAA;AAEJ;",
  "names": ["images"]
}
